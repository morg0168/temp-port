<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>workinprogress</title>
  <!-- <link rel="stylesheet" type="text/css" href="stylev1.css"> -->
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/flexboxgrid/6.3.1/flexboxgrid.min.css">
  <style>
    .contact-title {
      margin-top: 20vh !important;
    }

    canvas {
      /* position: relative; //top:5vh;
      left: 0;
      max-height: none; */
    }

    #container {
      position: relative;
      /* height: 100vh !important;
      width: 100vw; */
      float: none;

    }
  </style>
</head>

<body>
  <div id="container"></div>
  <nav>
    <!-- <ul class="content__text"> -->
    <ul id="test">
      <li id="test"><a href="index.html" class="">info</a></li>
      <li id="test2"><a href="projects.html" class="active">projects</a></li>
      <li id="test2"><a href="emily_resume_2018.pdf" class="" target="_blank">cv</a></li>
      <li id="test2"><a href="contact.html" class="">contact</a></li>
    </ul>
  </nav>
  <!-- built files will be auto injected -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.6.1/p5.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/4.7.1/pixi.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/pixi-filters/1.0.8/filters.min.js'></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/93/three.js"></script>
  <script src="./JDLoader.min.js"></script>
  <script src="./OrbitControls.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/skrollr/0.6.30/skrollr.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/skrollr/0.6.30/skrollr.min.js"></script>
  <script src="./anime.min.js"></script>
  <script src="./charming.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/2.0.1/TweenLite.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/2.0.1/TweenMax.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ScrollMagic/2.0.5/ScrollMagic.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ScrollMagic/2.0.5/plugins/animation.gsap.js"></script>
  <script>
    'use strict';


    //THREE JS CONFIG PRELOADING
    var scene = new THREE.Scene();
    var camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 5, 3000);
    // CAMERA
    //var camera = new THREE.PerspectiveCamera(75, 320 / 240, 1, 1000);
    //camera.position.set(250, 200, 250);

    camera.lookAt(0, 0, 0);

// add controls for the camera
    var controls = new THREE.OrbitControls(camera, game );
    controls.target.set( window.innerWidth / 10, 0, 1000 );
    controls.minDistance = 0;
    controls.maxDistance = 500;

    // var controls = new THREE.OrbitControls( camera );
    var distance = 1100;
    var raycaster;
    var projector;
    var container = document.getElementById('container');
    var game = new THREE.WebGLRenderer({
      antialias: true
    });
    var light;
    var light_two;
    var lightAmbient;
    var Asteroids = [];
    var min = 0;
    var max = 1;
    var asteroidContainer = [];
    const getRandomInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;

    var textureManager = new THREE.LoadingManager();
      textureManager.onProgress = function ( item, loaded, total ) {
          // this gets called after any item has been loaded
      };

      textureManager.onLoad = function () {
          // all textures are loaded
      };

    function init() {
      game.setSize(window.innerWidth, window.innerHeight);
      game.setClearColor(0xcccccc, 0.1);
      container.appendChild(game.domElement);
      container.style.marginLeft = "-1rem";
      camera.position.set(0, 0, distance);
      // controls.update();
      scene.add(camera);

      light = new THREE.PointLight(0xffffff, 1, 4000);
      light.castShadow = true; // default false
      light.position.set(250, 0, 750);


      light_two = new THREE.PointLight(0xffffff, 1, 4000);
      light_two.castShadow = true; // default false
      light_two.position.set(-250, -100, 0);


      lightAmbient = new THREE.AmbientLight(0x404040);
      lightAmbient.castShadow = true; // default false
      lightAmbient.position.set(-100, 800, 800);



      scene.add(light, light_two, lightAmbient);


      function Asteroid(i, Aster) {
        this.ind = i;
        // this.asteroidP = x;
        THREE.Object3D.apply(this, arguments);


        Aster.position.y = getRandomInt(positionMaxY, (positionMinY));
        Aster.position.x = getRandomInt(positionMaxX, (positionMinX));
        Aster.position.z = getRandomInt(0, 1500);

        Aster.rotation.y = getRandomInt(positionMaxY, (positionMinY));
        Aster.rotation.x = getRandomInt(positionMaxX, (positionMinX));
        Aster.rotation.z = getRandomInt(0, 1500);
        //Aster.rotation.y = 100;
        for (var j = 0; j < Asteroids.length; j++) {
          //if (i !== j && Asteroids[i].intersects(Asteroids[j])) {
          // console.log('splice');
            Asteroids.splice(i, Asteroids[i]);
          //  scene.remove(Asteroids[i]);
        //  }

        }
        // var sphere = new THREE.SphereGeometry();
        // var material = new THREE.MeshPhongMaterial({
        //   color: 0xeee8f3,
        //   shading: THREE.FlatShading,
        //   emissive: 0x111111
        // });
        // var particle = new THREE.Mesh(sphere, material);
        // particle.position.x = 0;
        // particle.position.y = 0;
        // particle.position.z = 0;
        // particle.scale.x = particle.scale.y = particle.scale.z = 30;
        //console.log(addAsteroid());
        this.add(Aster);
        // var box = new THREE.Box3().setFromObject( particle );
        // console.log( box.min, box.max, box.getSize() );
        scene.add(this);

      }

      Asteroid.prototype = Object.create(THREE.Object3D.prototype);
      Asteroid.prototype.constructor = Asteroid;

      Asteroid.prototype.intersects = function(other) {

        var x1 = this.position.x;
        var y1 = this.position.y;
        var z1 = this.position.z;

        var x2 = other.position.x;
        var y2 = other.position.y;
        var z2 = other.position.z;


        //var d = difference(x1, x2);
        function foo(num1, num2) {
          return (num1 > num2) ? num1 - num2 : num2 - num1
        }
        var d = foo(x1, x2);
        var dh = foo(y1, y2);
        var dz = foo(z1, z2);
        //console.log(x1, x2, d);

        if (dh < 100 && d < 100 && dz < 100) {
          return true
        } else {
          return false
        }
      }

      var positionMaxY = -game.domElement.clientHeight / 4;
      var positionMinY = game.domElement.clientHeight / 4;
      var positionMaxX = -game.domElement.clientWidth / 2;
      var positionMinX = game.domElement.clientWidth / 2;

      for (var i = 0; i < 100; i++) {

        var loader = new THREE.JDLoader(textureManager);
        loader.load("asteroid1.JD", function (data) {
            var texture = new THREE.TextureLoader().load("Asteroid_Texture1.jpg");
            texture.wrapS = THREE.RepeatWrapping;
            texture.wrapT = THREE.RepeatWrapping;
            texture.repeat.set(1, 1);
            var material = new THREE.MeshLambertMaterial({
                map: texture
            , });
              var Aster = new THREE.SkinnedMesh(data.geometries[0], material);
              Aster.scale.x = Aster.scale.y = Aster.scale.z = getRandomInt(10, 100);
              Aster.translation = THREE.GeometryUtils.center(data.geometries[0]);
              Aster.name = 'Aster';
              Aster.rotX = 0.001;
              Aster.rotY = 0.002;
              Aster.rotZ = 0.005;
              var asteroid = new Asteroid(i, Aster);
              Asteroids.push(asteroid);
        });



      }
      var color = new THREE.Color(0x00ff00);
      //let fogDust = new THREE.FogExp2(0xefd1b5, 0.0015, 400);
      //scene.fog = fogDust;
    }
    init();
    animate();

    function animate() {
      requestAnimationFrame(animate);
      render();
    };

    function render() {
      var timer = 0.00001 * Date.now();
      var amplitude = 0.1;
      var angle = 1;

      for (var i = 0; i < Asteroids.length; i++) {
        var object = Asteroids[i];
        //var vectorAxis = new THREE.Quaternion().setFromAxisAngle( object.children[0].position, Math.PI / 2 );
        //console.log(object.children[0].position);
        // object.children[0].rotation.y = new THREE.Euler().setFromQuaternion( vectorAxis );

        object.children[0].rotation.x += object.children[0].rotX;
        object.children[0].rotation.y += object.children[0].rotY;
        object.children[0].rotation.z += object.children[0].rotZ;


        //object.rotation.y += Math.PI / 50000 * (i + 1);
        //object.rotation.x += Math.PI / 10000 * i;
        //object.rotation.z += Math.PI / 10000 * i;
        //object.rotation.z += 0;


        if (object.position.x > game.domElement.clientWidth / 2) {
          //object.position.x = 0;
        }
        if (object.position.z > 900) {
          //object.position.z = 0;
        }

      }
      controls.update();
    //  controls.autoRotate = true;
      //controls.autoRotateSpeed = 0.1;
      game.render(scene, camera);
    }

    function onWindowResize() {
      camera.aspect = (window.innerWidth) / (window.innerHeight);
      game.setSize(window.innerWidth, window.innerHeight);
      camera.updateProjectionMatrix();
    };

    window.addEventListener('resize', onWindowResize, false);
  </script>
</body>

</html>
